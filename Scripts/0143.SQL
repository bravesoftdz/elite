/*
** TEMPO DE ATENDIMENTO NAS O.S.
*/

SET TERM ^ ;

ALTER TRIGGER OS_VENDER_BI0
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  /* TRIGGER TEXT */
  SELECT
    COMISSAO
  FROM
    CLIENTES
  WHERE
    CODIGO = NEW.CODVENDEDOR
  INTO
    NEW.COMISSAO;    

  /* TEMPO DE ATENDIMENTO */
  NEW.TMINUTOS = UDF_MINUTESBETWEEN(
    NEW.DATAINI,
    NEW.DATAFIM
  );

END

^

SET TERM ; ^

SET TERM ^ ;

ALTER TRIGGER OS_VENDER_BU0
ACTIVE BEFORE UPDATE POSITION 0
AS
BEGIN
  /* TRIGGER TEXT */
  SELECT
    COMISSAO
  FROM
    CLIENTES
  WHERE
    CODIGO = NEW.CODVENDEDOR
  INTO
    NEW.COMISSAO;

  /* TEMPO DE ATENDIMENTO */
  NEW.TMINUTOS = UDF_MINUTESBETWEEN(
    NEW.DATAINI,
    NEW.DATAFIM
  );
END

^

SET TERM ; ^

UPDATE
  OS_VENDER
SET
  TMINUTOS = UDF_MINUTESBETWEEN(DATAINI, DATAFIM);
  
ALTER TABLE OS_VENDER
ADD THORAS COMPUTED BY (CAST(TMINUTOS AS DOUBLE PRECISION) / 60);

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (143, CURRENT_TIMESTAMP);