/*
** FECHAMENTO DA VENDA WEB
*/

SET TERM ^ ;

CREATE PROCEDURE VENDA_FECHA (
    CODMOVIMENTO INTEGER)
AS
DECLARE VARIABLE TIPO INTEGER;
begin

  /* LEIO O TIPO ATUAL */
  SELECT
    TIPO
  FROM
    MOVIMENTOS
  WHERE
    CODIGO = :CODMOVIMENTO
  INTO
    :TIPO;

  IF (TIPO IN (2, 5)) THEN
   BEGIN

     IF (TIPO = 2) THEN
       TIPO = 3;
     ELSE
       TIPO = 6;

     UPDATE
       MOVIMENTOS
     SET
       TIPO = :TIPO
     WHERE
       CODIGO = :CODMOVIMENTO;

   END

end

^

SET TERM ; ^

GRANT EXECUTE ON PROCEDURE VENDA_FECHA TO PUBLIC;

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (185, CURRENT_TIMESTAMP);
COMMIT;