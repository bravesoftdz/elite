/*
** CORRECAO NA FICHA DE ESTOQUE
*/


ALTER TABLE MOVESTOQUE DROP CONSTRAINT MOVESTOQUE_PK;

DELETE FROM MOVESTOQUE;

COMMIT;

ALTER TABLE MOVESTOQUE ADD ID INTEIRO_VALIDO NOT NULL;

alter table MOVESTOQUE
add constraint MOVESTOQUE_PK
primary key (ID);

COMMIT;

SET TERM ^ ;

ALTER TRIGGER MOVESTOQUE_BI0
ACTIVE BEFORE INSERT POSITION 0
AS
begin
/* CALCULO DO ESTOQUE ATUAL */
SELECT
UDF_ABS(MAX(ID)) + 1
FROM
MOVESTOQUE
INTO
NEW.ID;

NEW.ESTOQUE = NEW.ESTOQUE_ANTERIOR + NEW.QUANTIDADE;
end

^

SET TERM ; ^

COMMIT;

EXECUTE PROCEDURE ACERTA_ESTOQUE;

COMMIT;
 
INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (197, CURRENT_TIMESTAMP);
COMMIT;