/*
** FIM DA MARGEM EM CAMPO CALCULADO - AINDA!!!
*/

SET TERM !;

ALTER TRIGGER PRODUTOS_MARGEM_INS
ACTIVE BEFORE INSERT POSITION 200
AS
BEGIN

  IF ((NEW.PRECOCUSTO = 0) AND (NEW.PRECOVENDA = 0)) THEN
   BEGIN

    NEW.MARGEM = 0;

   END ELSE
   BEGIN

     IF ((NEW.PRECOCUSTO = 0) AND (NEW.PRECOVENDA > 0)) THEN
      BEGIN

        NEW.MARGEM = NEW.PRECOVENDA * 100;

      END ELSE
      BEGIN

        NEW.MARGEM = (100 - ((NEW.PRECOVENDA * 100) / NEW.PRECOCUSTO)) * -1;

      END
   END

END!

ALTER TRIGGER PRODUTOS_MARGEM_UPD
ACTIVE BEFORE UPDATE POSITION 200
AS
BEGIN

  IF ((NEW.PRECOCUSTO = 0) AND (NEW.PRECOVENDA = 0)) THEN
   BEGIN

    NEW.MARGEM = 0;

   END ELSE
   BEGIN

     IF ((NEW.PRECOCUSTO = 0) AND (NEW.PRECOVENDA > 0)) THEN
      BEGIN

        NEW.MARGEM = NEW.PRECOVENDA * 100;

      END ELSE
      BEGIN

        NEW.MARGEM = (100 - ((NEW.PRECOVENDA * 100) / NEW.PRECOCUSTO)) * -1;

      END
   END

END!

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (122, CURRENT_TIMESTAMP)!