/*
** ALIQUOTAS FISCAIS
*/

SET TERM !;

CREATE EXCEPTION ICMS_ECF 'ALIQUOTA FISCAL INVALIDA'!

CREATE PROCEDURE ICMS_DARUMA345 (
    ICMS NUMERIC(9,4))
RETURNS (
    ALIQUOTA_FISCAL CHAR(2))
AS
begin
  /* aliquotas fiscais da daruma FS354 */

  ALIQUOTA_FISCAL = 'XX';

  IF (ICMS = 18.0000) THEN ALIQUOTA_FISCAL = 'TA';
  IF (ICMS = 12.0000) THEN ALIQUOTA_FISCAL = 'TB';
  IF (ICMS =  7.0000) THEN ALIQUOTA_FISCAL = 'TC';
  IF (ICMS =  3.6000) THEN ALIQUOTA_FISCAL = 'TD';

  IF (ALIQUOTA_FISCAL = 'XX') THEN
    EXCEPTION ICMS_ECF;
  ELSE
    SUSPEND;
end!

GRANT EXECUTE ON PROCEDURE ICMS_DARUMA345 TO PUBLIC!

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (112, CURRENT_TIMESTAMP)!